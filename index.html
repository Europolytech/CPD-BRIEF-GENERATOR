<!-- ==========================================================
   EP POPUP GENERATOR (Government-Briefing Style) — STABLE
   - Rich text fields (contenteditable)
   - Generates full embed code (centred button + popup)
   - Viewport-safe scrolling (no cut-off)
   - Button text hardened (Zoho gradient text overrides)
   - CTA text hardened (always white)
   - INLINE fallback styling (prevents "basic default button")
   - Escaped </script> as <\/script>
========================================================== -->

<style>
  :root{
    --ep-navy:#1f2f4a;
    --ep-border:#d8dde6;
    --ep-light:#f7f9fc;
    --ep-text:#1c2430;
    --ep-muted:#5f6b7a;
  }

  .ep-gen-wrap{
    max-width: 1050px;
    margin: 18px auto;
    padding: 18px;
    border: 1px solid var(--ep-border);
    border-radius: 10px;
    background: #fff;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    color: var(--ep-text);
  }
  .ep-gen-head{
    display:flex;
    gap: 12px;
    align-items:flex-start;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  .ep-gen-title{
    margin: 0;
    font-size: 18px;
    font-weight: 800;
    color: var(--ep-navy);
    letter-spacing: .2px;
  }
  .ep-gen-sub{
    margin: 6px 0 0;
    color: var(--ep-muted);
    line-height: 1.6;
    font-size: 14px;
    max-width: 85ch;
  }

  .ep-inline{
    display:flex;
    gap: 10px;
    align-items:center;
    flex-wrap: wrap;
  }
  .ep-inline label{
    font-size: 13px;
    color: var(--ep-muted);
    display:flex;
    gap: 8px;
    align-items:center;
  }
  .ep-inline input{
    padding: 10px 12px;
    border: 1px solid var(--ep-border);
    border-radius: 8px;
    min-width: 260px;
    font-size: 14px;
  }

  .ep-gen-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-top: 14px;
  }
  @media (max-width: 900px){
    .ep-gen-grid{ grid-template-columns: 1fr; }
  }

  .ep-field{
    border: 1px solid var(--ep-border);
    border-radius: 10px;
    overflow:hidden;
    background: #fff;
  }
  .ep-field-h{
    padding: 10px 12px;
    border-bottom: 1px solid var(--ep-border);
    background: var(--ep-light);
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 10px;
  }
  .ep-field-h b{
    font-size: 12px;
    letter-spacing: .7px;
    text-transform: uppercase;
    color: var(--ep-navy);
  }
  .ep-mini{
    font-size: 12px;
    color: var(--ep-muted);
  }
  .ep-edit{
    padding: 12px;
    min-height: 90px;
    outline: none;
    line-height: 1.65;
    color: var(--ep-text);
  }
  .ep-edit:empty:before{
    content: attr(data-placeholder);
    color: #8a93a3;
  }

  .ep-controls{
    display:flex;
    align-items:center;
    gap: 10px;
    margin-top: 14px;
    flex-wrap: wrap;
  }
  .ep-btn{
    background: white;
    color: var(--ep-navy);
    border: 1.5px solid var(--ep-navy);
    padding: 12px 18px;
    font-weight: 800;
    font-size: 14px;
    border-radius: 8px;
    cursor: pointer;
    transition: all .18s ease;
  }
  .ep-btn:hover{
    background: var(--ep-navy);
    color: white;
  }
  .ep-btn.secondary{
    border-color: var(--ep-border);
    color: var(--ep-text);
    font-weight: 700;
  }
  .ep-btn.secondary:hover{
    background: #f1f3f7;
    color: var(--ep-text);
    border-color: #cbd2df;
  }

  .ep-out{
    margin-top: 14px;
    border: 1px solid var(--ep-border);
    border-radius: 10px;
    overflow:hidden;
  }
  .ep-out-h{
    padding: 10px 12px;
    background: var(--ep-light);
    border-bottom: 1px solid var(--ep-border);
    display:flex;
    justify-content: space-between;
    align-items:center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .ep-out-h b{
    font-size: 12px;
    letter-spacing: .7px;
    text-transform: uppercase;
    color: var(--ep-navy);
  }
  textarea.ep-code{
    width: 100%;
    min-height: 320px;
    border: 0;
    padding: 12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-size: 12.5px;
    line-height: 1.55;
    resize: vertical;
    outline: none;
  }
</style>

<div class="ep-gen-wrap">
  <div class="ep-gen-head">
    <div>
      <h3 class="ep-gen-title">Popup Generator (Government Briefing Style)</h3>
      <p class="ep-gen-sub">
        Generates a full snippet (centred button + popup) with scroll-safe layout and hardened colours for Zoho themes.
      </p>
    </div>

    <div class="ep-inline">
      <label>Button label
        <input id="epBtnLabel" value="View Programme Brief" />
      </label>
      <label>CTA (mailto / URL)
        <input id="epCtaHref" value="mailto:admissions@europolytech.academy?subject=CPD%20Enquiry" />
      </label>
      <label>CTA text
        <input id="epCtaText" value="Request Information" />
      </label>
    </div>
  </div>

  <div class="ep-gen-grid">
    <div class="ep-field">
      <div class="ep-field-h"><b>Title</b><span class="ep-mini">Rich text allowed</span></div>
      <div class="ep-edit" id="fTitle" contenteditable="true">Sovereign Intelligence: Governance &amp; Ethical Frameworks in AI</div>
    </div>

    <div class="ep-field">
      <div class="ep-field-h"><b>Subtitle</b><span class="ep-mini">Rich text allowed</span></div>
      <div class="ep-edit" id="fSub" contenteditable="true">Executive CPD programme for senior decision-makers governing AI as an instrument of sovereignty, institutional legitimacy, and strategic autonomy.</div>
    </div>

    <div class="ep-field">
      <div class="ep-field-h"><b>Programme overview</b><span class="ep-mini">Rich text allowed</span></div>
      <div class="ep-edit" id="fOverview" contenteditable="true">
        Artificial Intelligence now operates as a domain of national power. This programme examines governance architecture, regulatory authority,
        procurement strategy, and ethical enforceability within sovereign AI ecosystems. Participants explore comparative models and produce applied
        oversight artefacts suitable for board and state-level contexts.
      </div>
    </div>

    <div class="ep-field">
      <div class="ep-field-h"><b>Programme format meta</b><span class="ep-mini">Use &lt;br&gt;</span></div>
      <div class="ep-edit" id="fMeta" contenteditable="true">
        <strong>CPD Hours:</strong> 15 hours<br>
        <strong>Delivery:</strong> In-person or blended executive format<br>
        <strong>Cohort Size:</strong> 12–20 participants (Roundtable: 8–12)<br>
        <strong>Assessment:</strong> Applied governance framework and executive decision artefacts
      </div>
    </div>

    <div class="ep-field">
      <div class="ep-field-h"><b>Learning objectives</b><span class="ep-mini">Use bullet list</span></div>
      <div class="ep-edit" id="fObjectives" contenteditable="true">
        <ul>
          <li>Evaluate AI governance models through sovereignty frameworks.</li>
          <li>Assess national AI strategies and regulatory leverage.</li>
          <li>Identify procurement and strategic dependency risks.</li>
          <li>Design enforceable AI oversight mechanisms.</li>
          <li>Integrate ethics into operational governance structures.</li>
        </ul>
      </div>
    </div>

    <div class="ep-field">
      <div class="ep-field-h"><b>Target participants</b><span class="ep-mini">Use bullet list</span></div>
      <div class="ep-edit" id="fAudience" contenteditable="true">
        <ul>
          <li>Senior regulators and policy leaders</li>
          <li>Government and ministerial advisers</li>
          <li>SOE and sovereign fund executives</li>
          <li>Board members overseeing AI deployment</li>
          <li>Cyber and national security leadership</li>
        </ul>
      </div>
    </div>

    <div class="ep-field">
      <div class="ep-field-h"><b>Core themes</b><span class="ep-mini">Use bullet list</span></div>
      <div class="ep-edit" id="fThemes" contenteditable="true">
        <ul>
          <li>Digital sovereignty &amp; data localisation</li>
          <li>Comparative governance models (EU / UK / Gulf / China)</li>
          <li>Regulatory power vs innovation ecosystems</li>
          <li>AI procurement, strategic dependency, accountability</li>
          <li>Crisis governance in AI failure events</li>
        </ul>
      </div>
    </div>

    <div class="ep-field">
      <div class="ep-field-h"><b>Footer note</b><span class="ep-mini">Rich text allowed</span></div>
      <div class="ep-edit" id="fFooter" contenteditable="true">CPD Certificate issued upon completion.</div>
    </div>
  </div>

  <div class="ep-controls">
    <button class="ep-btn" id="btnGenerate">Generate Popup Code</button>
    <button class="ep-btn secondary" id="btnCopy">Copy Code</button>
  </div>

  <div class="ep-out">
    <div class="ep-out-h">
      <b>Generated embed code</b>
      <span class="ep-mini">Paste into Zoho</span>
    </div>
    <textarea class="ep-code" id="outCode" spellcheck="false"></textarea>
  </div>
</div>

<script>
(function(){
  const $ = (id) => document.getElementById(id);

  const btnLabel = $("epBtnLabel");
  const ctaHref  = $("epCtaHref");
  const ctaText  = $("epCtaText");

  const fTitle = $("fTitle");
  const fSub = $("fSub");
  const fOverview = $("fOverview");
  const fMeta = $("fMeta");
  const fObjectives = $("fObjectives");
  const fAudience = $("fAudience");
  const fThemes = $("fThemes");
  const fFooter = $("fFooter");

  const out = $("outCode");

  function sanitise(html){
    return (html || "")
      .replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi, "")
      .replace(/\son\w+="[^"]*"/gi, "")
      .replace(/\son\w+='[^']*'/gi, "");
  }
  function escTL(str){
    return str.replace(/`/g, "\\`").replace(/\$\{/g, "\\${");
  }
  function uid(){ return Math.random().toString(36).slice(2, 8); }

  function build(p){
    const inlineBtn = 'background:#fff;color:#1f2f4a;border:1.5px solid #1f2f4a;padding:14px 26px;font-weight:800;font-size:15px;letter-spacing:.3px;border-radius:8px;cursor:pointer;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;';
    const inlineCta = 'background:#1f2f4a;color:#ffffff;padding:12px 22px;border-radius:8px;text-decoration:none;font-weight:800;font-size:14px;display:inline-flex;align-items:center;gap:10px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;';

    return `<!-- =========================
   EP CPD POPUP (Government Briefing Style)
   Generated snippet: centred button + popup
========================= -->

<style>
  :root{
    --ep-navy:#1f2f4a;
    --ep-border:#d8dde6;
    --ep-light:#f7f9fc;
    --ep-text:#1c2430;
    --ep-muted:#5f6b7a;
  }

  .ep-brief-center-${p.uid}{ width:100%; display:flex; justify-content:center; }

  /* Button — hardened */
  .ep-brief-btn-${p.uid}{
    background:#fff !important;
    color:var(--ep-navy) !important;
    -webkit-text-fill-color: var(--ep-navy) !important;
    background-clip:border-box !important;
    -webkit-background-clip:border-box !important;
    text-shadow:none !important;

    border:1.5px solid var(--ep-navy) !important;
    padding:14px 26px !important;
    font-weight:800 !important;
    font-size:15px !important;
    letter-spacing:.3px !important;
    border-radius:8px !important;
    cursor:pointer !important;
    transition:all .18s ease !important;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif !important;
  }
  .ep-brief-btn-${p.uid}:hover{
    background:var(--ep-navy) !important;
    color:#fff !important;
    -webkit-text-fill-color:#fff !important;
  }

  /* Overlay + viewport-safe scrolling */
  .ep-overlay-${p.uid}{
    position:fixed; inset:0;
    background:rgba(0,0,0,.32);
    display:none;
    z-index:99999;
    padding:42px 18px;
    overflow:auto;
    box-sizing:border-box;
  }
  .ep-overlay-${p.uid}.active{ display:block; }

  .ep-modal-${p.uid}{
    max-width:980px;
    margin:auto;
    background:#fff;
    border:1px solid var(--ep-border);
    border-radius:10px;
    box-shadow:0 30px 70px rgba(0,0,0,.15);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    color:var(--ep-text);
    overflow:hidden;
    max-height:calc(100vh - 84px);
    display:flex;
    flex-direction:column;
  }

  .ep-header-${p.uid}{ padding:26px 30px 18px; border-bottom:1px solid var(--ep-border); }
  .ep-title-${p.uid}{ font-size:20px; font-weight:800; margin:0; color:var(--ep-navy); line-height:1.35; }
  .ep-sub-${p.uid}{ margin-top:8px; font-size:15px; color:var(--ep-muted); line-height:1.65; }

  .ep-body-${p.uid}{ padding:30px; overflow:auto; -webkit-overflow-scrolling:touch; }

  .ep-section-${p.uid}{ margin-bottom:26px; }
  .ep-section-${p.uid} h4{
    font-size:12px; letter-spacing:.9px; text-transform:uppercase;
    margin:0 0 12px; color:var(--ep-navy);
  }
  .ep-copy-${p.uid}{ line-height:1.75; color:var(--ep-muted); font-size:15px; }

  .ep-grid-${p.uid}{ display:grid; grid-template-columns:1fr 1fr; gap:24px; }
  @media(max-width:850px){ .ep-grid-${p.uid}{ grid-template-columns:1fr; } }

  .ep-meta-${p.uid}{
    background:var(--ep-light); padding:18px; border-radius:8px;
    border:1px solid var(--ep-border); font-size:14px; line-height:1.7; color:var(--ep-text);
  }

  .ep-footer-${p.uid}{
    padding:18px 30px; border-top:1px solid var(--ep-border);
    display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px;
  }

  /* CTA — hardened: always white in all states */
  .ep-cta-${p.uid}, .ep-cta-${p.uid}:link, .ep-cta-${p.uid}:visited, .ep-cta-${p.uid}:hover, .ep-cta-${p.uid}:active{
    background:var(--ep-navy) !important;
    color:#ffffff !important;
    -webkit-text-fill-color:#ffffff !important;
    text-decoration:none !important;
    text-shadow:none !important;
    padding:12px 22px !important;
    border-radius:8px !important;
    font-weight:800 !important;
    font-size:14px !important;
    display:inline-flex !important;
    align-items:center !important;
    gap:10px !important;
  }

  .ep-close-${p.uid}{
    background:none;
    border:1px solid var(--ep-border);
    width:40px; height:40px;
    border-radius:10px;
    cursor:pointer;
    color:var(--ep-muted);
    display:grid;
    place-items:center;
  }
  .ep-close-${p.uid}:hover{ background:var(--ep-light); }

  .ep-modal-${p.uid} ul{ margin:10px 0 0; padding-left:18px; }
  .ep-modal-${p.uid} li{ margin:6px 0; }
  .ep-modal-${p.uid} a{ color:var(--ep-navy); text-decoration:underline; text-underline-offset:3px; }
</style>

<div class="ep-brief-center-${p.uid}">
  <button type="button"
          class="ep-brief-btn-${p.uid}"
          id="epOpen-${p.uid}"
          style="${inlineBtn}">
    ${p.buttonLabel}
  </button>
</div>

<div class="ep-overlay-${p.uid}" id="epOverlay-${p.uid}" aria-hidden="true">
  <div class="ep-modal-${p.uid}" role="dialog" aria-modal="true" aria-labelledby="epTitle-${p.uid}">
    <div class="ep-header-${p.uid}">
      <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px;">
        <div>
          <h3 class="ep-title-${p.uid}" id="epTitle-${p.uid}">${p.title}</h3>
          <div class="ep-sub-${p.uid}">${p.subtitle}</div>
        </div>
        <button type="button" class="ep-close-${p.uid}" id="epClose-${p.uid}" aria-label="Close">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 6L18 18M18 6L6 18" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="ep-body-${p.uid}">
      <div class="ep-section-${p.uid}">
        <h4>Programme Overview</h4>
        <div class="ep-copy-${p.uid}">${p.overview}</div>
      </div>

      <div class="ep-grid-${p.uid}">
        <div class="ep-section-${p.uid}">
          <h4>Learning Objectives</h4>
          <div class="ep-copy-${p.uid}">${p.objectives}</div>
        </div>
        <div class="ep-section-${p.uid}">
          <h4>Target Participants</h4>
          <div class="ep-copy-${p.uid}">${p.audience}</div>
        </div>
      </div>

      <div class="ep-section-${p.uid}">
        <h4>Core Themes</h4>
        <div class="ep-copy-${p.uid}">${p.themes}</div>
      </div>

      <div class="ep-section-${p.uid}">
        <h4>Programme Format</h4>
        <div class="ep-meta-${p.uid}">${p.meta}</div>
      </div>
    </div>

    <div class="ep-footer-${p.uid}">
      <div style="color:var(--ep-muted); font-size:14px; line-height:1.55;">${p.footerNote}</div>
      <a class="ep-cta-${p.uid}"
         href="${p.ctaHref}"
         style="${inlineCta}">
        ${p.ctaText} <span aria-hidden="true">→</span>
      </a>
    </div>
  </div>
</div>

<script>
(function(){
  var openBtn = document.getElementById("epOpen-${p.uid}");
  var overlay = document.getElementById("epOverlay-${p.uid}");
  var closeBtn = document.getElementById("epClose-${p.uid}");

  function openModal(){
    overlay.classList.add("active");
    overlay.setAttribute("aria-hidden","false");
    document.body.style.overflow = "hidden";
  }
  function closeModal(){
    overlay.classList.remove("active");
    overlay.setAttribute("aria-hidden","true");
    document.body.style.overflow = "";
  }

  openBtn.addEventListener("click", openModal);
  closeBtn.addEventListener("click", closeModal);
  overlay.addEventListener("click", function(e){ if(e.target === overlay) closeModal(); });
  document.addEventListener("keydown", function(e){
    if(overlay.classList.contains("active") && e.key === "Escape") closeModal();
  });
})();
<\/script>`;
  }

  function generate(){
    const id = uid();
    const p = {
      uid: id,
      buttonLabel: escTL(sanitise(btnLabel.value.trim() || "View Programme Brief")),
      ctaHref: escTL(sanitise(ctaHref.value.trim() || "#")),
      ctaText: escTL(sanitise(ctaText.value.trim() || "Request Information")),
      title: escTL(sanitise(fTitle.innerHTML.trim())),
      subtitle: escTL(sanitise(fSub.innerHTML.trim())),
      overview: escTL(sanitise(fOverview.innerHTML.trim())),
      meta: escTL(sanitise(fMeta.innerHTML.trim())),
      objectives: escTL(sanitise(fObjectives.innerHTML.trim())),
      audience: escTL(sanitise(fAudience.innerHTML.trim())),
      themes: escTL(sanitise(fThemes.innerHTML.trim())),
      footerNote: escTL(sanitise(fFooter.innerHTML.trim()))
    };

    out.value = build(p);
    out.focus();
    out.select();
  }

  async function copy(){
    if(!out.value.trim()) generate();
    try{
      await navigator.clipboard.writeText(out.value);
    }catch(e){
      out.focus(); out.select();
      document.execCommand("copy");
    }
  }

  $("btnGenerate").addEventListener("click", generate);
  $("btnCopy").addEventListener("click", copy);

  generate();
})();
</script>
